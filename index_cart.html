<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ANARO ‚Äî Danh m·ª•c + Gi·ªè h√†ng</title>
  <style>
    :root{--bg:#f6efe9;--text:#2a221d;--panel:#a47148;--ink:#F8EBDD;--border:#e9d7c5;--dot:#6b3f25}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#fff,var(--bg) 50%,#f0e2d6);color:var(--text)}
    .wrap{max-width:1200px;margin:0 auto;padding:0 16px}

    /* Header */
    header.page{position:sticky;top:0;z-index:10;background:#ffffffcc;backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid var(--border)}
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 0}
    h1{margin:0;font-size:20px}
    .nav{display:flex;gap:10px;align-items:center}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:8px 12px;border-radius:10px;border:1px solid #0001;background:#0001;text-decoration:none;color:#6b3f25;font-weight:800;cursor:pointer}
    .cartbtn{position:relative}
    .cartcount{position:absolute;top:-6px;right:-6px;background:#a47148;color:var(--ink);border-radius:999px;font-size:12px;padding:0 6px}

    /* Catalog */
    .category{margin:18px 0}
    .category-title{background:#a47148cc;color:var(--ink);padding:10px 14px;border-radius:12px;text-align:center;font-weight:900}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
    .card{background:#fff;border:1px solid var(--border);border-radius:14px;display:flex;flex-direction:column}
    .card header{padding:12px 14px}
    .title{margin:0}
    .best{margin:0 14px 10px;background:var(--panel);color:var(--ink);padding:8px 10px;border-radius:10px;font-size:14px}
    .row{display:flex;gap:8px;align-items:center;margin:0 14px 10px}
    .rating{display:inline-grid;grid-auto-flow:column;gap:4px;color:var(--dot)}
    .dot{width:10px;height:10px;border-radius:50%;border:1px solid currentColor}
    .dot.f{background:currentColor}
    .methods{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:0 14px 12px}
    .method{padding:6px 8px;border:1px solid #0001;border-radius:8px;background:#0001;text-align:center;font-weight:700}
    .pick{display:flex;gap:8px;align-items:center;margin:0 14px 12px}
    select, input[type="number"]{padding:8px 10px;border:1px solid #0002;border-radius:10px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin:0 14px 12px}
    .chip{display:inline-flex;gap:8px;padding:6px 10px;border:1px solid #0001;background:#0001;border-radius:8px;font-weight:700}
    .actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:12px 14px 14px}
    .primary{background:#F8EBDD;border-color:transparent}

    footer.card{margin-top:auto;border-top:1px solid var(--border);padding:10px 12px;text-align:center;color:#806a5b;font-size:12px;background:#ffffffaa;border-bottom-left-radius:14px;border-bottom-right-radius:14px}

    /* Cart Drawer */
    .backdrop{position:fixed;inset:0;background:#0007;display:none}
    .drawer{position:fixed;right:0;top:0;bottom:0;width:380px;max-width:95vw;background:#fff;border-left:1px solid var(--border);box-shadow:-8px 0 30px #0003;transform:translateX(100%);transition:transform .25s ease;display:flex;flex-direction:column}
    .drawer.open{transform:translateX(0)}
    .carthead{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
    .cartlist{flex:1;overflow:auto;padding:10px 14px;display:grid;gap:10px}
    .cartrow{display:grid;grid-template-columns:1fr auto;gap:8px;border:1px solid #0001;background:#0001;border-radius:10px;padding:8px 10px}
    .cartrow .meta{font-weight:700}
    .qty{display:flex;align-items:center;gap:6px}
    .qty input{width:64px;padding:6px 8px;border:1px solid #0002;border-radius:8px}
    .cartfoot{border-top:1px solid var(--border);padding:12px 14px;display:grid;gap:10px}
    .total{display:flex;justify-content:space-between;font-weight:900}
    .ghost{background:#eee;border:1px solid #0001;border-radius:10px;padding:10px 12px;font-weight:900;cursor:pointer}

    @media (max-width:480px){.methods{grid-template-columns:1fr}.drawer{width:100%}}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="page">
      <div class="top">
        <h1>‚òï ANARO COFFEE</h1>
        <div class="nav">
          <a class="btn" href="faq.html">‚ùì C√¢u h·ªèi th∆∞·ªùng g·∫∑p</a>
          <button id="openCart" class="btn cartbtn">üß∫ Gi·ªè h√†ng <span id="count" class="cartcount">0</span></button>
        </div>
      </div>
    </header>

    <section id="catalog"></section>
  </div>

  <!-- Drawer gi·ªè h√†ng -->
  <div id="backdrop" class="backdrop"></div>
  <aside id="drawer" class="drawer" aria-label="Gi·ªè h√†ng">
    <div class="carthead">
      <strong>Gi·ªè h√†ng</strong>
      <button id="closeCart" class="btn">‚úï</button>
    </div>
    <div id="cartList" class="cartlist"></div>
    <div class="cartfoot">
      <div id="total" class="total"><span>T·ªïng</span><span>0ƒë</span></div>
      <button id="clear" class="ghost">Xo√° gi·ªè</button>
      <a id="checkout" class="btn primary" href="checkout.html">Ti·∫øn h√†nh thanh to√°n</a>
    </div>
  </aside>

  <script>
    // ===== D·ªÆ LI·ªÜU =====
    const products = [
      {id:'arabica-cau-dat', category:'√äM NH·∫∏ ‚Äì THANH', name:'Arabica C·∫ßu ƒê·∫•t', best:'Tr√°i c√¢y, nh·∫π nh√†ng', stats:{s:2,c:2,r:2}, methods:{phin:2,espresso:2}, price:{'250g':100000,'500g':210000,'1kg':360000}},
      {id:'arabica-da-lat', category:'√äM NH·∫∏ ‚Äì THANH', name:'Arabica ƒê√† L·∫°t', best:'C√¢n b·∫±ng, classic', stats:{s:2,c:2,r:2}, methods:{phin:3,espresso:2, pour:3}, price:{'250g':90000,'500g':195000,'1kg':330000}},
      {id:'blend-3', category:'√äM NH·∫∏ ‚Äì THANH', name:'Blend S·ªë 3', best:'C·∫ßu n·ªëi nh·∫π ‚Üî ƒë·∫≠m', stats:{s:3,c:3,r:3}, methods:{phin:3,espresso:2}, price:{'250g':85000,'500g':181250,'1kg':302500}},
      {id:'blend-9', category:'√äM NH·∫∏ ‚Äì THANH', name:'Blend S·ªë 9', best:'ƒê·∫≠m nh∆∞ng h·∫≠u ng·ªçt', stats:{s:3,c:3,r:2}, methods:{phin:3,espresso:3}, price:{'250g':95000,'500g':201250,'1kg':342500}},
      {id:'blend-2', category:'C√ÇN B·∫∞NG ‚Äì TR√íN V·ªä', name:'Blend S·ªë 2', best:'Ly s·ªØa body & caffeine', stats:{s:4,c:4,r:4}, methods:{phin:3,espresso:3}, price:{'250g':80000,'500g':173750,'1kg':287500}},
      {id:'blend-10', category:'C√ÇN B·∫∞NG ‚Äì TR√íN V·ªä', name:'Blend S·ªë 10', best:'ƒê·∫≠m-tr√≤n, h·∫≠u ng·ªçt', stats:{s:4,c:4,r:4}, methods:{phin:3,espresso:3}, price:{'250g':93000,'500g':197750,'1kg':335500}},
      {id:'tam-bo-6', category:'C√ÇN B·∫∞NG ‚Äì TR√íN V·ªä', name:'T·∫©m b∆° S·ªë 6', best:'Ch·ªâ pha phin', stats:{s:4,c:4,r:3}, methods:{phin:3}, price:{'250g':85000,'500g':178750,'1kg':297500}},
      {id:'tam-bo-7', category:'C√ÇN B·∫∞NG ‚Äì TR√íN V·ªä', name:'T·∫©m b∆° S·ªë 7', best:'Ch·ªâ pha phin', stats:{s:3,c:3,r:3}, methods:{phin:3}, price:{'250g':90000,'500g':186250,'1kg':312500}},
      {id:'robusta-honey', category:'ƒê·∫¨M M·∫†NH ‚Äì H·∫¨U D√ÄI', name:'Robusta Honey', best:'ƒê·∫≠m ng·ªçt h·∫≠u', stats:{s:4,c:4,r:4}, methods:{phin:3,espresso:2}, price:{'250g':89000,'500g':192500,'1kg':325000}},
      {id:'robusta-moc', category:'ƒê·∫¨M M·∫†NH ‚Äì H·∫¨U D√ÄI', name:'Robusta M·ªôc', best:'R·∫•t ƒë·∫≠m, m·ªôc', stats:{s:5,c:5,r:4}, methods:{phin:3,espresso:3}, price:{'250g':75000,'500g':167500,'1kg':275000}},
      {id:'culi-moc', category:'ƒê·∫¨M M·∫†NH ‚Äì H·∫¨U D√ÄI', name:'Culi M·ªôc', best:'ƒê·∫≠m m∆∞·ª£t, h·∫≠u d√†i', stats:{s:5,c:5,r:4}, methods:{phin:3,espresso:3}, price:{'250g':75000,'500g':167500,'1kg':275000}},
    ];

    // ===== UTIL =====
    const $ = (s,ctx=document)=>ctx.querySelector(s);
    const $$ = (s,ctx=document)=>Array.from(ctx.querySelectorAll(s));
    const fmt = n => (n||0).toLocaleString('vi-VN')+"ƒë";
    const saveCart = (x)=>localStorage.setItem('anaro_cart', JSON.stringify(x));
    const loadCart = ()=>{ try{return JSON.parse(localStorage.getItem('anaro_cart')||'[]')}catch(e){return []} };

    // ===== RENDER CATALOG =====
    const byCat = products.reduce((a,p)=>((a[p.category]??=[]).push(p),a),{});
    const catalog = $('#catalog');
    catalog.innerHTML = Object.entries(byCat).map(([cat,items])=>{
      const cards = items.map(p=>{
        const sizeOpts = Object.keys(p.price).map(s=>`<option value="${s}">${s} ‚Äî ${fmt(p.price[s])}</option>`).join('');
        return `<article class="card" data-id="${p.id}">
          <header><h3 class="title">${p.name}</h3></header>
          <p class="best">üéØ ${p.best}</p>
          <div class="row">‚òï ƒê·ªô ƒë·∫≠m:&nbsp;<span class="rating">${[...Array(5)].map((_,i)=>`<span class="dot ${i<(p.stats.s||0)?'f':''}"></span>`).join('')}</span></div>
          <div class="methods">${p.methods.phin?`<div class="method">ü´ñ Phin ${'‚òÖ'.repeat(p.methods.phin)}</div>`:''}${p.methods.espresso?`<div class="method">‚òï Espresso ${'‚òÖ'.repeat(p.methods.espresso)}</div>`:''}${p.methods.pour?`<div class="method">üåä Pour Over ${'‚òÖ'.repeat(p.methods.pour)}</div>`:''}</div>
          <div class="pick">
            <label for="size-${p.id}">Ch·ªçn kh·ªëi l∆∞·ª£ng:</label>
            <select id="size-${p.id}" class="size">
              ${sizeOpts}
            </select>
            <label for="qty-${p.id}">SL:</label>
            <input id="qty-${p.id}" class="qtyin" type="number" min="1" value="1" />
          </div>
          <div class="actions">
            <button class="btn primary add">Th√™m v√†o gi·ªè</button>
            <a class="btn" href="faq.html">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</a>
          </div>
          <footer class="card">ANARO Coffee Guide ¬∑ ¬© 2025</footer>
        </article>`
      }).join('');
      return `<section class="category"><h2 class="category-title">${cat}</h2><div class="grid">${cards}</div></section>`
    }).join('');

    // ===== CART STATE =====
    let cart = loadCart();
    const count = $('#count');
    const backdrop = $('#backdrop');
    const drawer = $('#drawer');
    const cartList = $('#cartList');
    const totalEl = $('#total span:last-child');

    function syncBadge(){
      const n = cart.reduce((s,i)=>s+i.qty,0); count.textContent = n; saveCart(cart);
    }
    function calcTotal(){ return cart.reduce((s,i)=>s + i.price*i.qty,0); }

    function renderCart(){
      if(cart.length===0){ cartList.innerHTML = '<p>Gi·ªè tr·ªëng. H√£y th√™m v√†i m√≥n nh√©!</p>'; totalEl.textContent = fmt(0); return; }
      cartList.innerHTML = cart.map((it,idx)=>{
        return `<div class="cartrow" data-idx="${idx}">
          <div>
            <div class="meta">${it.name} ‚Äî ${it.size}</div>
            <div class="hint">${fmt(it.price)} √ó ${it.qty}</div>
          </div>
          <div class="qty">
            <input type="number" min="1" value="${it.qty}" class="qedit" />
            <button class="btn del">Xo√°</button>
          </div>
        </div>`
      }).join('');
      totalEl.textContent = fmt(calcTotal());
    }

    function openCart(){ backdrop.style.display='block'; drawer.classList.add('open'); renderCart(); }
    function closeCart(){ backdrop.style.display='none'; drawer.classList.remove('open'); }

    $('#openCart').addEventListener('click', openCart);
    $('#closeCart').addEventListener('click', closeCart);
    backdrop.addEventListener('click', closeCart);

    // Add to cart handlers
    catalog.addEventListener('click', (e)=>{
      const addBtn = e.target.closest('.add');
      if(!addBtn) return;
      const card = e.target.closest('.card');
      const id = card.dataset.id;
      const p = products.find(x=>x.id===id);
      const size = card.querySelector('.size').value;
      const qty = Math.max(1, parseInt(card.querySelector('.qtyin').value||'1',10));
      const price = p.price[size];

      // merge by id+size
      const key = id+'_'+size;
      const i = cart.findIndex(x=>x.key===key);
      if(i>-1){ cart[i].qty += qty; }
      else { cart.push({ key, id, name:p.name, size, price, qty }); }
      syncBadge();
      openCart();
    });

    // Cart interactions
    cartList.addEventListener('input', (e)=>{
      const row = e.target.closest('.cartrow');
      if(!row) return;
      const idx = +row.dataset.idx;
      if(e.target.classList.contains('qedit')){
        const v = Math.max(1, parseInt(e.target.value||'1',10));
        cart[idx].qty = v; syncBadge(); renderCart();
      }
    });
    cartList.addEventListener('click', (e)=>{
      const row = e.target.closest('.cartrow');
      if(!row) return;
      const idx = +row.dataset.idx;
      if(e.target.classList.contains('del')){
        cart.splice(idx,1); syncBadge(); renderCart();
      }
    });

    $('#clear').addEventListener('click', ()=>{ cart=[]; syncBadge(); renderCart(); });

    // Pass cart to checkout via localStorage
    $('#checkout').addEventListener('click', ()=>{
      localStorage.setItem('anaro_cart', JSON.stringify(cart));
    });

    // initial
    syncBadge();
  </script>
</body>
</html>
