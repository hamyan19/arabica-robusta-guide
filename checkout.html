<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ANARO ‚Äî Checkout</title>
  <style>
    :root{--bg:#fffdf9;--text:#2a221d;--muted:#6e625a;--border:#eadfd4;--brand:#7a4b2b}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:0 auto;padding:20px 16px}
    header{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border)}
    h1{margin:0;font-size:22px}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-top:16px}
    .card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}
    .title{margin:0 0 8px 0;font-size:16px}
    label{font-size:13px;font-weight:700;color:#6b3f25}
    input[type="text"], input[type="email"], textarea{padding:10px;border:1px solid #0002;border-radius:10px;width:100%}
    textarea{min-height:90px;resize:vertical}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .gender{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
    .opt{display:flex;gap:6px;align-items:center;padding:8px 10px;border:1px solid #0001;border-radius:10px;background:#0001;cursor:pointer}
    .line{display:flex;justify-content:space-between;margin:6px 0}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid #0001;background:#0001;color:#1e1e1e;font-weight:800;cursor:pointer;text-decoration:none}
    .cta{background:#F8EBDD;border-color:transparent}
    .srow{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .ico{width:18px;height:18px;display:inline-block}
    footer{margin-top:24px;color:#6e625a;font-size:12px;text-align:center}
    .toast{position:fixed;left:50%;top:16px;transform:translateX(-50%);background:#2a221d;color:#fff;padding:10px 14px;border-radius:10px;z-index:9999}

    /* Popup modal */
    .backdrop{position:fixed;inset:0;background:#0007;display:none;align-items:center;justify-content:center;z-index:1000}
    .modal{width:min(520px,92vw);background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 40px #0005;padding:16px}
    .modal h3{margin:0 0 6px}
    .modal p{margin:6px 0;color:var(--muted)}
    .modal .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .modal .btn{background:#0001}
    .modal .cta{background:#F8EBDD}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>‚òï ANARO COFFEE ‚Äî Thanh to√°n</h1>
      <a class="btn" href="index.html">‚Üê Ti·∫øp t·ª•c mua</a>
    </header>

    <div class="grid">
      <!-- LEFT: Customer Info -->
      <section class="card">
        <h2 class="title">Th√¥ng tin ng∆∞·ªùi nh·∫≠n</h2>
        <div class="row2">
          <div>
            <label for="recipient">T√™n ng∆∞·ªùi nh·∫≠n</label>
            <input id="recipient" type="text" placeholder="VD: Nguy·ªÖn VƒÉn A" />
          </div>
          <div>
            <label>Gi·ªõi t√≠nh (x∆∞ng h√¥)</label>
            <div class="gender">
              <label class="opt"><input type="radio" name="gender" value="Anh" checked /> Anh</label>
              <label class="opt"><input type="radio" name="gender" value="Ch·ªã" /> Ch·ªã</label>
              <label class="opt"><input type="radio" name="gender" value="Kh√°c" /> Kh√°c</label>
            </div>
          </div>
        </div>
        <div class="row2" style="margin-top:10px">
          <div>
            <label for="email">Email</label>
            <input id="email" type="email" placeholder="you@example.com" />
          </div>
          <div>
            <label for="phone">S·ªë ƒëi·ªán tho·∫°i</label>
            <input id="phone" type="text" placeholder="09xx xxx xxx" />
          </div>
        </div>
        <div style="margin-top:10px">
          <label for="note">Ghi ch√∫</label>
          <textarea id="note" placeholder="Ghi ch√∫ th√™m (khung gi·ªù nh·∫≠n, ƒë·ªãa ch·ªâ chi ti·∫øt, v.v.)"></textarea>
        </div>

        <h3 class="title" style="margin-top:14px">Li√™n h·ªá / X√°c nh·∫≠n ƒë∆°n</h3>
        <div class="srow">
          <a id="linkZalo" class="btn" target="_blank" rel="noopener" href="#" aria-label="Zalo">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="5" ry="5" fill="#0068FF"/><text x="6.7" y="16.5" font-family="Segoe UI, Roboto, Helvetica, Arial" font-size="10" fill="#fff" font-weight="700">Z</text></svg>
            </span>
            <span>Zalo</span>
          </a>
          <a id="linkMsg" class="btn" target="_blank" rel="noopener" href="#" aria-label="Messenger">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" fill="#0099FF"/><path d="M6.5 14.2l4.1-3.1 3.1 3.1 3.3-3.1" fill="none" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </span>
            <span>Messenger</span>
          </a>
          <a id="linkFan" class="btn" target="_blank" rel="noopener" href="#" aria-label="Fanpage Facebook">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="5" ry="5" fill="#1877F2"/><path d="M14 8h2V6h-2a3 3 0 0 0-3 3v2H9v2h2v5h2v-5h2l1-2h-3V9a1 1 0 0 1 1-1z" fill="#fff"/></svg>
            </span>
            <span>Fanpage</span>
          </a>
        </div>
      </section>

      <!-- RIGHT: Order Summary -->
      <section class="card">
        <h2 class="title">ƒê∆°n h√†ng</h2>
        <div class="line"><strong>Ti·ªÅn h√†ng</strong><span id="co-subtotal">0ƒë</span></div>
        <div class="line"><span>C√¢n n·∫∑ng</span><span id="co-weight">0 kg</span></div>
        <div class="line"><span>Ph√≠ ship</span><span id="co-ship">0ƒë</span></div>
        <div class="line"><strong>T·ªïng</strong><strong id="co-total">0ƒë</strong></div>
        <div class="muted" id="co-items" style="margin-top:8px"></div>
        <div style="margin-top:12px">
          <button id="placeOrder" class="btn cta">ƒê·∫∑t h√†ng</button>
        </div>
      </section>
    </div>

    <footer>ANARO COFFEE ¬∑ ¬© 2025</footer>
  </div>

  <!-- Success popup -->
  <div id="backdrop" class="backdrop" role="dialog" aria-modal="true" aria-labelledby="okTitle">
    <div class="modal">
      <h3 id="okTitle">üéâ ƒê·∫∑t h√†ng th√†nh c√¥ng</h3>
      <p id="okSub">C·∫£m ∆°n b·∫°n! Ch√∫ng t√¥i s·∫Ω li√™n h·ªá x√°c nh·∫≠n s·ªõm nh·∫•t.</p>
      <div class="row">
        <a class="btn" href="index.html">‚Üê Ti·∫øp t·ª•c mua</a>
        <a id="okZalo" class="btn" target="_blank" rel="noopener">Zalo</a>
        <a id="okMsg" class="btn" target="_blank" rel="noopener">Messenger</a>
        <a id="okFan" class="btn" target="_blank" rel="noopener">Fanpage</a>
      </div>
    </div>
  </div>

  <script>
    // ====== Config ======
    const FORM_EMAIL = "anmy1909@gmail.com"; // ƒë·ªïi n·∫øu c·∫ßn
    const FORM_ENDPOINT = "https://formsubmit.co/ajax/" + encodeURIComponent(FORM_EMAIL);

    // Social links
    const SOCIAL_LINKS = {
      zalo: "https://zalo.me/84918337071",
      messenger: "https://m.me/anarocoffee",
      fanpage: "https://www.facebook.com/anarocoffee/"
    };

    // ====== Helpers ======
    const fmt = n => (n||0).toLocaleString('vi-VN') + "ƒë";
    function showToast(msg){
      const t = document.createElement('div'); t.className='toast'; t.textContent = msg; document.body.appendChild(t);
      setTimeout(()=>t.remove(), 2600);
    }
    function showPopup(){
      const bd = document.getElementById('backdrop');
      bd.style.display = 'flex';
    }
    function hidePopup(){
      const bd = document.getElementById('backdrop');
      bd.style.display = 'none';
    }
    document.getElementById('backdrop').addEventListener('click', (e)=>{
      if(e.target.id==='backdrop') hidePopup();
    });

    function readPayloadFromHash(){
      try{
        const m = location.hash.match(/[#&]p=([^&]+)/);
        if(!m) return null;
        const json = decodeURIComponent(escape(atob(m[1])));
        return JSON.parse(json);
      }catch(e){ return null; }
    }

    function bindSocialLinks(){
      document.getElementById('linkZalo').href = SOCIAL_LINKS.zalo;
      document.getElementById('linkMsg').href  = SOCIAL_LINKS.messenger;
      document.getElementById('linkFan').href  = SOCIAL_LINKS.fanpage;

      document.getElementById('okZalo').href = SOCIAL_LINKS.zalo;
      document.getElementById('okMsg').href  = SOCIAL_LINKS.messenger;
      document.getElementById('okFan').href  = SOCIAL_LINKS.fanpage;
    }

    function renderOrderSummary(payload){
      if(!payload) return;
      const { items=[], subtotal=0, weightKg=0, shipping=0, total=0 } = payload;
      document.getElementById('co-subtotal').textContent = fmt(subtotal);
      document.getElementById('co-weight').textContent   = (weightKg||0).toFixed(2) + " kg";
      document.getElementById('co-ship').textContent     = fmt(shipping);
      document.getElementById('co-total').textContent    = fmt(total);
      const lines = items.map(it => `‚Ä¢ ${it.name} ‚Äî ${it.size} ‚Äî ${it.grind} √ó ${it.qty}`).join('<br>');
      document.getElementById('co-items').innerHTML = lines || '';
    }

    function getRecipient(){
      const name = document.getElementById('recipient').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const note = document.getElementById('note').value.trim();
      const g = document.querySelector('input[name="gender"]:checked');
      const gender = g ? g.value : "Anh";
      return { name, email, phone, note, gender };
    }

    async function sendOrderByEmail(payload){
      const r = payload.recipient || {};
      const itemsStr = (payload.items||[]).map(i=>`${i.name} ‚Äî ${i.size} ‚Äî ${i.grind} √ó ${i.qty}`).join("; ");
      const body = {
        _subject: "ƒê∆°n h√†ng m·ªõi t·ª´ ANARO COFFEE",
        _template: "table",
        "Ng∆∞·ªùi nh·∫≠n": `${r.gender||""} ${r.name||""}`.trim(),
        "Email": r.email||"",
        "SƒêT": r.phone||"",
        "Ghi ch√∫": r.note||"",
        "Ti·ªÅn h√†ng": (payload.subtotal||0),
        "Ph√≠ ship": (payload.shipping||0),
        "T·ªïng": (payload.total||0),
        "C√¢n n·∫∑ng (kg)": (payload.weightKg||0),
        "Chi ti·∫øt": itemsStr,
        "JSON": JSON.stringify(payload)
      };

      const res = await fetch(FORM_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json", "Accept": "application/json" },
        body: JSON.stringify(body)
      });
      if(!res.ok){ throw new Error(await res.text()); }
      return res.json().catch(()=>({}));
    }

    document.getElementById('placeOrder').addEventListener('click', async ()=>{
      try{
        const payload = readPayloadFromHash() || {};
        payload.recipient = getRecipient();
        payload.contact = { ...SOCIAL_LINKS };

        await sendOrderByEmail(payload);
        showPopup(); // ‚úÖ show success popup, no redirect
      }catch(err){
        console.error(err);
        showToast("G·ª≠i ƒë∆°n th·∫•t b·∫°i, vui l√≤ng th·ª≠ l·∫°i.");
      }
    });

    (function init(){
      bindSocialLinks();
      renderOrderSummary(readPayloadFromHash());
    })();
  </script>
</body>
</html>
