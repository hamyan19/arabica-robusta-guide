<!-- ===== CHECKOUT INFO + SOCIAL (drop-in) ===== -->
<section id="checkoutInfo" class="checkout">
  <style>
    #checkoutInfo{display:grid;gap:14px;background:#faf6f2;border:1px dashed #e7d4c4;border-radius:12px;padding:12px}
    #checkoutInfo .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    #checkoutInfo label{font-size:13px;font-weight:700;color:#6b3f25}
    #checkoutInfo input[type="text"]{padding:10px;border:1px solid #0002;border-radius:10px;width:100%}
    #checkoutInfo .gender{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
    #checkoutInfo .opt{display:flex;gap:6px;align-items:center;padding:8px 10px;border:1px solid #0001;border-radius:10px;background:#0001;cursor:pointer}
    #checkoutInfo .social{display:grid;gap:8px}
    #checkoutInfo .srow{display:flex;gap:8px;flex-wrap:wrap}
    #checkoutInfo .sbtn{display:inline-flex;align-items:center;gap:8px;padding:9px 12px;border:1px solid #0001;border-radius:10px;background:#fff;text-decoration:none;color:#1e1e1e;font-weight:800}
    #checkoutInfo .ico{width:18px;height:18px;display:inline-block}
    #checkoutInfo .sum{background:#fff;border:1px solid #f0e2d6;border-radius:10px;padding:10px}
    #checkoutInfo .line{display:flex;justify-content:space-between}
    #checkoutInfo .muted{font-size:12px;color:#6b3f25}
    @media (max-width:560px){#checkoutInfo .row2{grid-template-columns:1fr}}
  </style>

  <!-- Tóm tắt đơn (đọc từ hash #p=...) -->
  <div id="orderSummary" class="sum" aria-live="polite">
    <div class="line"><strong>Tiền hàng</strong><span id="co-subtotal">0đ</span></div>
    <div class="line"><span>Cân nặng</span><span id="co-weight">0 kg</span></div>
    <div class="line"><span>Phí ship</span><span id="co-ship">0đ</span></div>
    <div class="line"><strong>Tổng</strong><strong id="co-total">0đ</strong></div>
    <div class="muted" id="co-items"></div>
  </div>

  <!-- Thông tin người nhận -->
  <div class="row2">
    <div>
      <label for="recipient">Tên người nhận</label>
      <input id="recipient" type="text" placeholder="VD: Nguyễn Văn A" />
    </div>
    <div>
      <label>Giới tính (xưng hô)</label>
      <div class="gender">
        <label class="opt"><input type="radio" name="gender" value="Anh" checked /> Anh</label>
        <label class="opt"><input type="radio" name="gender" value="Chị" /> Chị</label>
        <label class="opt"><input type="radio" name="gender" value="Khác" /> Khác</label>
      </div>
    </div>
  </div>

  <!-- Kênh liên hệ -->
  <div class="social">
    <div><strong>Liên hệ / Xác nhận đơn qua:</strong></div>
    <div class="srow">
      <a id="linkZalo" class="sbtn" target="_blank" rel="noopener" href="#" aria-label="Zalo">
        <span class="ico" aria-hidden="true">
          <!-- Zalo icon #0068FF -->
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="5" ry="5" fill="#0068FF"/><text x="6.7" y="16.5" font-family="Segoe UI, Roboto, Helvetica, Arial" font-size="10" fill="#fff" font-weight="700">Z</text></svg>
        </span>
        <span>Zalo</span>
      </a>
      <a id="linkMsg" class="sbtn" target="_blank" rel="noopener" href="#" aria-label="Messenger">
        <span class="ico" aria-hidden="true">
          <!-- Messenger #0099FF -->
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" fill="#0099FF"/><path d="M6.5 14.2l4.1-3.1 3.1 3.1 3.3-3.1" fill="none" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </span>
        <span>Messenger</span>
      </a>
      <a id="linkFan" class="sbtn" target="_blank" rel="noopener" href="#" aria-label="Fanpage Facebook">
        <span class="ico" aria-hidden="true">
          <!-- Facebook #1877F2 -->
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="5" ry="5" fill="#1877F2"/><path d="M14 8h2V6h-2a3 3 0 0 0-3 3v2H9v2h2v5h2v-5h2l1-2h-3V9a1 1 0 0 1 1-1z" fill="#fff"/></svg>
        </span>
        <span>Fanpage</span>
      </a>
    </div>
    <div class="muted">Sửa 3 URL trong biến <code>SOCIAL_LINKS</code> bên dưới.</div>
  </div>

  <script>
    // ---- Config: sửa 3 link thật tại đây ----
    const SOCIAL_LINKS = {
      zalo: "https://zalo.me/your-id",
      messenger: "https://business.facebook.com/latest/inbox/all/?asset_id=731140580350268&business_id=171278373886023&nav_ref=manage_page_ap_plus_inbox_message_button",
      fanpage: "https://www.facebook.com/anarocoffee/"
    };

    // ---- Helper format tiền ----
    const fmt = n => (n||0).toLocaleString('vi-VN') + "đ";

    // ---- Đọc payload từ URL #p= (base64 JSON) ---
    function readPayloadFromHash(){
      try{
        const m = location.hash.match(/[#&]p=([^&]+)/);
        if(!m) return null;
        const json = decodeURIComponent(escape(atob(m[1])));
        return JSON.parse(json);
      }catch(e){ return null; }
    }

    // ---- Gán URL social ----
    function bindSocialLinks(){
      document.getElementById('linkZalo').href = SOCIAL_LINKS.zalo;
      document.getElementById('linkMsg').href  = SOCIAL_LINKS.messenger;
      document.getElementById('linkFan').href  = SOCIAL_LINKS.fanpage;
    }

    // ---- Render tóm tắt đơn nếu có payload ----
    function renderOrderSummary(payload){
      if(!payload) return;
      const { items=[], subtotal=0, weightKg=0, shipping=0, total=0 } = payload;
      document.getElementById('co-subtotal').textContent = fmt(subtotal);
      document.getElementById('co-weight').textContent   = (weightKg||0).toFixed(2) + " kg";
      document.getElementById('co-ship').textContent     = fmt(shipping);
      document.getElementById('co-total').textContent    = fmt(total);
      // Danh sách rút gọn
      const lines = items.map(it => `• ${it.name} — ${it.size} — ${it.grind} × ${it.qty}`).join('<br>');
      document.getElementById('co-items').innerHTML = lines || '';
    }

    // ---- API để trang checkout lấy info khi submit ----
    window.getCheckoutInfo = function(){
      const name = document.getElementById('recipient').value.trim();
      const g = document.querySelector('input[name="gender"]:checked');
      return { name, gender: g ? g.value : "Anh" };
    };

    // ---- Khởi tạo ----
    (function initCheckout(){
      bindSocialLinks();
      renderOrderSummary(readPayloadFromHash());
    })();
  </script>
</section>
<!-- ===== END CHECKOUT INFO + SOCIAL ===== -->
